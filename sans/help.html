<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Aide - Test audio/micro</title>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  </head>
  <body class="bg-gray-50 text-gray-800 font-sans">
    <section
      class="min-h-screen flex flex-col justify-center items-center px-4 py-10 text-center"
    >
      <h1 class="text-3xl sm:text-5xl font-bold mb-6">
        Aide & V√©rification des autorisations
      </h1>

      <p class="text-lg text-gray-600 mb-4 max-w-2xl">
        V√©rifiez que l'application a bien acc√®s √† votre
        <strong>microphone</strong> et vos <strong>enceintes</strong>. Si vous
        √™tes sur pc, assurez-vous d'avoir un micro et des enceintes
        fonctionnels. Si vous √™tes sur mobile, v√©rifiez que les permissions sont
        accord√©es dans les param√®tres de votre appareil.
      </p>

      <!-- Test Micro -->
      <button
        id="testMic"
        class="mt-6 mb-2 px-6 py-3 bg-blue-600 text-white rounded-xl shadow hover:bg-blue-700 flex items-center gap-2"
      >
        <i data-lucide="mic"></i> Tester le micro
      </button>
      <div id="micStatus" class="text-sm text-gray-500 mb-6"></div>

      <!-- Test Enceintes -->
      <button
        id="testSound"
        class="mb-2 px-6 py-3 bg-green-600 text-white rounded-xl shadow hover:bg-green-700 flex items-center gap-2"
      >
        <i data-lucide="volume-2"></i> Tester les enceintes
      </button>

      <div id="audioStatus" class="text-sm text-gray-500 mb-10"></div>

      <!-- Tutos selon navigateur -->
      <h2 class="text-xl font-semibold mb-4">
        Tutoriel pour activer le micro :
      </h2>
      <div
        id="browserHelp"
        class="text-left bg-white p-6 rounded-xl shadow max-w-xl text-gray-700 space-y-3"
      >
        <p>Chargement du tutoriel en fonction de votre navigateur...</p>
      </div>
      <div class="mt-8">
        <a
          href="/experience.html"
          class="inline-flex items-center px-6 py-3 bg-blue-600 text-white text-lg font-semibold rounded-2xl shadow hover:bg-blue-700 transition"
        >
          <i data-lucide="rocket" class="w-5 h-5 mr-2"></i>
          Aller √† la page de cr√©ation de compte
        </a>
      </div>
    </section>

    <!-- Script pour les fonctionnalit√©s -->
    <script>
      lucide.createIcons();

      const micBtn = document.getElementById("testMic");
      const micStatus = document.getElementById("micStatus");
      micBtn.addEventListener("click", async () => {
        micStatus.textContent = "Test du micro en cours...";
        try {
          const stream = await navigator.mediaDevices.getUserMedia({
            audio: true,
          });
          micStatus.textContent = "‚úÖ Micro d√©tect√© et autoris√© !";
          stream.getTracks().forEach((track) => track.stop());
        } catch (err) {
          micStatus.textContent = "‚ùå Micro non autoris√© ou non d√©tect√©.";
        }
      });

      const soundBtn = document.getElementById("testSound");
      const audioStatus = document.getElementById("audioStatus");
      soundBtn.addEventListener("click", () => {
        const audio = new Audio(
          "https://www.soundjay.com/button/sounds/button-3.mp3"
        );
        audio
          .play()
          .then(() => {
            audioStatus.textContent = "üîä Son jou√© avec succ√®s.";
          })
          .catch(() => {
            audioStatus.textContent = "‚ùå Impossible de jouer un son.";
          });
      });

      // D√©tection navigateur & tutoriel
      const helpBox = document.getElementById("browserHelp");
      const ua = navigator.userAgent;

      let tuto = "";
      if (/Chrome/.test(ua)) {
        tuto = `
        <strong>Google Chrome :</strong>
        <ul class="list-disc ml-6 space-y-1">
          <li>Cliquez sur l'ic√¥ne du cadenas üîí √† gauche de l'URL.</li>
          <li>Autorisez le microphone dans les param√®tres du site.</li>
          <li>Rechargez la page si n√©cessaire.</li>
        </ul>
      `;
      } else if (/Firefox/.test(ua)) {
        tuto = `
        <strong>Mozilla Firefox :</strong>
        <ul class="list-disc ml-6 space-y-1">
          <li>Une ic√¥ne de micro appara√Æt dans la barre d‚Äôadresse.</li>
          <li>Cliquez dessus et autorisez l‚Äôacc√®s au micro.</li>
          <li>V√©rifiez vos param√®tres de confidentialit√© si besoin.</li>
        </ul>
      `;
      } else if (/Safari/.test(ua)) {
        tuto = `
        <strong>Safari (Mac) :</strong>
        <ul class="list-disc ml-6 space-y-1">
          <li>Allez dans les Pr√©f√©rences Safari &gt; Sites web &gt; Microphone.</li>
          <li>Autorisez le micro pour ce site.</li>
        </ul>
      `;
      } else if (/Edg/.test(ua)) {
        tuto = `
        <strong>Microsoft Edge :</strong>
        <ul class="list-disc ml-6 space-y-1">
          <li>Cliquez sur l‚Äôic√¥ne de cadenas dans la barre d‚ÄôURL.</li>
          <li>G√©rez les autorisations et activez le micro.</li>
        </ul>
      `;
      } else {
        tuto = `<p>Votre navigateur n‚Äôest pas reconnu. Veuillez v√©rifier les param√®tres de permissions pour ce site.</p>`;
      }

      helpBox.innerHTML = tuto;
    </script>
  </body>
</html>
